# ============================================
# Docker Compose Stack - Práctica 03
# ============================================
# Orquesta múltiples servicios:
# - API FastAPI
# - PostgreSQL
# - Redis
# Descomenta las secciones paso a paso.
# ============================================


# ============================================
# SERVICIO: API FastAPI
# ============================================
# La aplicación principal que se conecta a DB y Redis.

# Descomenta las siguientes líneas:

# services:
#   api:
#     build: .
#     ports:
#       - "8000:8000"
#     environment:
#       - DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}
#       - REDIS_URL=redis://redis:6379/0
#       - DEBUG=true
#     depends_on:
#       db:
#         condition: service_healthy
#       redis:
#         condition: service_started
#     networks:
#       - backend
#     restart: unless-stopped


# ============================================
# SERVICIO: PostgreSQL
# ============================================
# Base de datos relacional con healthcheck.

# Descomenta las siguientes líneas (dentro de services:):

#   db:
#     image: postgres:17-alpine
#     environment:
#       - POSTGRES_USER=${POSTGRES_USER}
#       - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
#       - POSTGRES_DB=${POSTGRES_DB}
#     volumes:
#       - pgdata:/var/lib/postgresql/data
#     networks:
#       - backend
#     healthcheck:
#       test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"]
#       interval: 5s
#       timeout: 5s
#       retries: 5
#     restart: unless-stopped


# ============================================
# SERVICIO: Redis
# ============================================
# Cache y almacén clave-valor en memoria.

# Descomenta las siguientes líneas (dentro de services:):

#   redis:
#     image: redis:7-alpine
#     command: redis-server --appendonly yes
#     volumes:
#       - redisdata:/data
#     networks:
#       - backend
#     restart: unless-stopped


# ============================================
# VOLÚMENES
# ============================================
# Almacenamiento persistente para datos.

# Descomenta las siguientes líneas:

# volumes:
#   pgdata:
#   redisdata:


# ============================================
# REDES
# ============================================
# Red privada para comunicación entre servicios.

# Descomenta las siguientes líneas:

# networks:
#   backend:
#     driver: bridge


# ============================================
# DESAFÍO EXTRA (opcional)
# ============================================
# 1. Agrega un servicio adminer para administrar PostgreSQL:
#
#   adminer:
#     image: adminer
#     ports:
#       - "8080:8080"
#     networks:
#       - backend
#
# 2. Crea docker-compose.override.yml para desarrollo:
#
# services:
#   api:
#     volumes:
#       - ./src:/app/src
#     command: uvicorn src.main:app --host 0.0.0.0 --reload
