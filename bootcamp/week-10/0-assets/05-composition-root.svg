<svg viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: bold 20px 'Inter', sans-serif; fill: #e0e0e0; }
      .label { font: 600 12px 'Inter', sans-serif; fill: #e0e0e0; }
      .small { font: 10px 'Inter', sans-serif; fill: #b0b0b0; }
      .code { font: 10px 'Consolas', monospace; fill: #00bcd4; }
      .main { fill: #3a4a3a; stroke: #4caf50; stroke-width: 2; }
      .deps { fill: #3a3a4a; stroke: #2196f3; stroke-width: 2; }
      .factory { fill: #4a3a2a; stroke: #ff9800; stroke-width: 2; }
      .instance { fill: #2a3a4a; stroke: #00897b; stroke-width: 2; }
      .arrow { fill: none; stroke: #888; stroke-width: 1.5; marker-end: url(#arr); }
      .arrow-create { fill: none; stroke: #4caf50; stroke-width: 2; stroke-dasharray: 5,3; marker-end: url(#arr2); }
    </style>
    <marker id="arr" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#888"/>
    </marker>
    <marker id="arr2" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#4caf50"/>
    </marker>
  </defs>
  
  <rect width="800" height="450" fill="#1e1e1e"/>
  
  <text x="400" y="30" class="title" text-anchor="middle">Composition Root - Ensamblaje de Dependencias</text>
  
  <!-- main.py -->
  <rect x="300" y="50" width="200" height="80" rx="8" class="main"/>
  <text x="400" y="75" class="label" text-anchor="middle">COMPOSITION ROOT</text>
  <text x="400" y="95" class="code" text-anchor="middle">main.py</text>
  <text x="400" y="115" class="small" text-anchor="middle">create_app() / lifespan</text>
  
  <!-- dependencies.py -->
  <rect x="300" y="160" width="200" height="100" rx="8" class="deps"/>
  <text x="400" y="185" class="label" text-anchor="middle">DEPENDENCIES</text>
  <text x="400" y="205" class="code" text-anchor="middle">dependencies.py</text>
  <text x="320" y="230" class="small">get_task_repository()</text>
  <text x="320" y="248" class="small">get_task_service()</text>
  
  <!-- Factories -->
  <rect x="50" y="290" width="150" height="100" rx="8" class="factory"/>
  <text x="125" y="315" class="label" text-anchor="middle">FACTORY</text>
  <text x="125" y="340" class="code" text-anchor="middle">@lru_cache</text>
  <text x="70" y="365" class="small">Singleton pattern</text>
  <text x="70" y="380" class="small">Returns instance</text>
  
  <!-- Repository Instance -->
  <rect x="230" y="290" width="150" height="100" rx="8" class="instance"/>
  <text x="305" y="315" class="label" text-anchor="middle">REPOSITORY</text>
  <text x="305" y="340" class="code" text-anchor="middle">InMemoryTaskRepo</text>
  <text x="250" y="365" class="small">Implements Port</text>
  <text x="250" y="380" class="small">(TaskRepository)</text>
  
  <!-- Service Instance -->
  <rect x="420" y="290" width="150" height="100" rx="8" class="instance"/>
  <text x="495" y="315" class="label" text-anchor="middle">SERVICE</text>
  <text x="495" y="340" class="code" text-anchor="middle">TaskService</text>
  <text x="440" y="365" class="small">Uses Repository</text>
  <text x="440" y="380" class="small">via Port</text>
  
  <!-- Router Instance -->
  <rect x="600" y="290" width="150" height="100" rx="8" class="instance"/>
  <text x="675" y="315" class="label" text-anchor="middle">ROUTER</text>
  <text x="675" y="340" class="code" text-anchor="middle">tasks_router</text>
  <text x="620" y="365" class="small">Uses Service</text>
  <text x="620" y="380" class="small">Depends()</text>
  
  <!-- Arrows -->
  <path d="M 400 130 L 400 160" class="arrow"/>
  <path d="M 300 210 L 200 290" class="arrow-create"/>
  <path d="M 350 260 L 305 290" class="arrow-create"/>
  <path d="M 450 260 L 495 290" class="arrow-create"/>
  <path d="M 500 210 L 675 290" class="arrow"/>
  
  <!-- Injection arrows -->
  <path d="M 380 340 L 420 340" class="arrow"/>
  <path d="M 570 340 L 600 340" class="arrow"/>
  
  <!-- Labels -->
  <text x="160" y="275" class="small" fill="#4caf50">creates</text>
  <text x="320" y="275" class="small" fill="#4caf50">creates</text>
  <text x="460" y="275" class="small" fill="#4caf50">creates</text>
  <text x="395" y="330" class="small">injects</text>
  <text x="580" y="330" class="small">injects</text>
  
  <!-- FastAPI dependency_overrides -->
  <rect x="600" y="160" width="150" height="80" rx="8" fill="#2a2a3a" stroke="#9e9e9e" stroke-width="2"/>
  <text x="675" y="185" class="label" text-anchor="middle">TESTING</text>
  <text x="675" y="205" class="code" text-anchor="middle">dependency_overrides</text>
  <text x="620" y="225" class="small">Swap implementations</text>
  
  <!-- Legend -->
  <text x="50" y="430" class="small">ðŸŸ¢ main.py: Punto de entrada</text>
  <text x="250" y="430" class="small">ðŸ”µ dependencies.py: Factories</text>
  <text x="470" y="430" class="small">ðŸŸ  @lru_cache: Singleton</text>
  <text x="650" y="430" class="small">â¬œ Instances creadas</text>
</svg>
